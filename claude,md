# DessaTech - Plataforma para Profesionales de Salud Mental

## Contexto del Proyecto

DessaTech es una plataforma digital integral diseÃ±ada para profesionales de salud mental que optimiza la organizaciÃ³n del trabajo clÃ­nico, fortalece el seguimiento de consultantes y promueve la calidad profesional.

## Stack TecnolÃ³gico

- **Framework**: Next.js 15 (App Router, Turbopack)
- **Lenguaje**: TypeScript (strict mode)
- **Estilos**: Tailwind CSS
- **Base de datos**: Supabase (PostgreSQL + Auth + Storage + Realtime)
- **IA**: OpenRouter (Grok free tier)
- **Linting**: ESLint
- **Despliegue**: Vercel (recomendado)
- **Futuras extensiones**: Telegram Bot, PWA

## Estructura del Proyecto

```
dessatech/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”œâ”€â”€ consultantes/
â”‚   â”‚   â”œâ”€â”€ agenda/
â”‚   â”‚   â”œâ”€â”€ sesiones/
â”‚   â”‚   â”œâ”€â”€ recursos/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â””â”€â”€ telegram/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/ (shadcn/ui components)
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ consultantes/
â”‚   â”‚   â”œâ”€â”€ sesiones/
â”‚   â”‚   â”œâ”€â”€ agenda/
â”‚   â”‚   â””â”€â”€ ai-assistant/
â”‚   â””â”€â”€ shared/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ openrouter/
â”‚   â”‚   â””â”€â”€ client.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ encryption.ts
â”‚   â”‚   â”œâ”€â”€ validators.ts
â”‚   â”‚   â””â”€â”€ formatters.ts
â”‚   â””â”€â”€ hooks/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ database.ts
â”‚   â”œâ”€â”€ consultante.ts
â”‚   â””â”€â”€ sesion.ts
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ functions/
â”‚   â””â”€â”€ config.toml
â””â”€â”€ public/
```

## GuÃ­as de Desarrollo

### TypeScript Strict Mode
- Usar tipos explÃ­citos, evitar `any`
- Preferir interfaces para objetos, types para unions/intersections
- Usar Zod para validaciÃ³n de datos externos
- Aprovechar los tipos generados automÃ¡ticamente de Supabase

### App Router Best Practices
- Server Components por defecto
- Client Components solo cuando sea necesario (interactividad, hooks, contexto)
- Usar Server Actions para mutaciones de datos
- Implementar streaming con Suspense boundaries
- Aprovechar parallel routes y intercepting routes para modals

### Supabase Integration
- Row Level Security (RLS) habilitado en todas las tablas
- PolÃ­ticas de seguridad estrictas por rol de usuario
- Usar Supabase Auth con providers personalizados
- Cifrado de columnas sensibles (notas clÃ­nicas, datos personales)
- Edge Functions para lÃ³gica backend compleja

### OpenRouter/IA
- Rate limiting por usuario
- CachÃ© de respuestas comunes
- Streaming de respuestas para mejor UX
- Prompt engineering especÃ­fico para contexto clÃ­nico
- Sistema de fallback si el servicio falla

### Seguridad y Privacidad
- NUNCA almacenar datos sensibles sin cifrar
- Implementar auditorÃ­a de accesos a fichas clÃ­nicas
- Consentimiento explÃ­cito para uso de IA
- Cumplimiento con normativas de protecciÃ³n de datos de salud
- Session management seguro

## Funcionalidades Prioritarias (MVP)

### 1. Sistema de AutenticaciÃ³n
```typescript
// Flujo completo con Supabase Auth
// - Email + Password
// - Magic Link opcional
// - VerificaciÃ³n de email
// - Recovery de contraseÃ±a
// - Profile setup post-registro
```

### 2. GestiÃ³n de Consultantes
```typescript
interface Consultante {
  id: string;
  nombre_completo: string; // Cifrado
  email?: string; // Cifrado
  telefono?: string; // Cifrado
  fecha_nacimiento?: Date;
  motivo_consulta: string; // Cifrado
  objetivos_terapeuticos: string[];
  estado: 'activo' | 'inactivo' | 'alta';
  created_at: Date;
  updated_at: Date;
  profesional_id: string;
}

// Funcionalidades:
// - CRUD completo
// - BÃºsqueda y filtros
// - Vista de timeline de sesiones
// - GrÃ¡ficos de evoluciÃ³n
// - Documentos adjuntos cifrados
```

### 3. Sistema de Sesiones
```typescript
interface Sesion {
  id: string;
  consultante_id: string;
  fecha: Date;
  duracion: number; // minutos
  modalidad: 'presencial' | 'videollamada' | 'telefÃ³nica';
  notas: string; // Cifrado
  objetivos_trabajados: string[];
  tareas_asignadas?: string;
  proxima_sesion?: Date;
  estado: 'programada' | 'completada' | 'cancelada';
  created_at: Date;
}

// Funcionalidades:
// - Registro rÃ¡pido post-sesiÃ³n
// - Asistente IA para notas
// - Timer de sesiÃ³n
// - Plantillas de notas
```

### 4. Asistente de IA
```typescript
// Casos de uso prioritarios:
// 1. GeneraciÃ³n de resumen de sesiÃ³n
// 2. Sugerencias de objetivos terapÃ©uticos
// 3. AnÃ¡lisis de patrones en notas
// 4. BÃºsqueda semÃ¡ntica en historial clÃ­nico
// 5. Consultas sobre tÃ©cnicas/intervenciones

// ImplementaciÃ³n con streaming:
async function generateSessionSummary(
  sessionNotes: string,
  context: ConsultanteContext
): Promise<ReadableStream>
```

### 5. Agenda y Recordatorios
```typescript
interface Cita {
  id: string;
  consultante_id: string;
  fecha_hora: Date;
  duracion: number;
  modalidad: 'presencial' | 'videollamada' | 'telefÃ³nica';
  estado: 'confirmada' | 'pendiente' | 'cancelada';
  notas?: string;
  recordatorio_enviado: boolean;
}

// Funcionalidades:
// - Vista de calendario (dÃ­a/semana/mes)
// - Drag & drop para reprogramar
// - Recordatorios automÃ¡ticos (email/telegram)
// - SincronizaciÃ³n con Google Calendar (opcional)
// - Bloques de disponibilidad
```

## Schema Supabase Inicial

```sql
-- Profiles (extiende auth.users)
create table profiles (
  id uuid references auth.users primary key,
  nombre_completo text not null,
  especialidad text[],
  numero_matricula text,
  telefono text,
  configuracion jsonb default '{}'::jsonb,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- Consultantes
create table consultantes (
  id uuid primary key default gen_random_uuid(),
  profesional_id uuid references profiles not null,
  nombre_completo text not null, -- cifrado en app layer
  email text,
  telefono text,
  fecha_nacimiento date,
  motivo_consulta text,
  objetivos_terapeuticos jsonb default '[]'::jsonb,
  estado text default 'activo',
  metadata jsonb default '{}'::jsonb,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- Sesiones
create table sesiones (
  id uuid primary key default gen_random_uuid(),
  consultante_id uuid references consultantes not null,
  fecha timestamptz not null,
  duracion int not null,
  modalidad text not null,
  notas text, -- cifrado en app layer
  objetivos_trabajados text[],
  tareas_asignadas text,
  proxima_sesion timestamptz,
  estado text default 'completada',
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- Citas
create table citas (
  id uuid primary key default gen_random_uuid(),
  consultante_id uuid references consultantes not null,
  fecha_hora timestamptz not null,
  duracion int not null,
  modalidad text not null,
  estado text default 'pendiente',
  notas text,
  recordatorio_enviado boolean default false,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

-- AI Interactions (auditorÃ­a)
create table ai_interactions (
  id uuid primary key default gen_random_uuid(),
  profesional_id uuid references profiles not null,
  tipo text not null, -- 'summary', 'suggestion', 'search', etc
  prompt_hash text not null, -- hash del prompt, no el contenido
  tokens_usados int,
  costo numeric(10,6),
  created_at timestamptz default now()
);

-- RLS Policies (ejemplo para consultantes)
alter table consultantes enable row level security;

create policy "Usuarios ven solo sus consultantes"
  on consultantes for select
  using (auth.uid() = profesional_id);

create policy "Usuarios pueden crear consultantes"
  on consultantes for insert
  with check (auth.uid() = profesional_id);

create policy "Usuarios pueden actualizar sus consultantes"
  on consultantes for update
  using (auth.uid() = profesional_id);
```

## Integraciones Futuras

### Telegram Bot
```typescript
// Bot para profesionales
// Comandos:
// /agenda - Ver agenda del dÃ­a
// /nota [consultante] [texto] - Agregar nota rÃ¡pida
// /recordatorios - Gestionar recordatorios
// /consulta [pregunta] - Consultar IA sobre caso

// ImplementaciÃ³n con Telegraf + webhooks
```

### PWA
```typescript
// ConfiguraciÃ³n en next.config.js
// - Service Worker para offline
// - Manifest para instalaciÃ³n
// - Cache de datos crÃ­ticos
// - Sync en background
```

## Variables de Entorno

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# OpenRouter
OPENROUTER_API_KEY=
OPENROUTER_APP_NAME=dessatech
OPENROUTER_SITE_URL=

# Encryption
ENCRYPTION_KEY= # Para cifrado de datos sensibles

# Telegram (futuro)
TELEGRAM_BOT_TOKEN=

# General
NEXT_PUBLIC_APP_URL=
```

## Comandos Ãštiles

```bash
# Desarrollo
npm run dev # Usa Turbopack automÃ¡ticamente

# Build
npm run build

# Lint
npm run lint

# Type check
npm run type-check # Agregar script: "tsc --noEmit"

# Supabase local
npx supabase start
npx supabase db reset
npx supabase gen types typescript --local > types/database.ts

# Migrations
npx supabase migration new nombre_migration
npx supabase db push
```

## Principios de DiseÃ±o

1. **Privacy by Design**: Cifrado primero, minimizaciÃ³n de datos
2. **Ethical AI**: IA como asistente, transparencia en uso
3. **Mobile First**: Responsive, tÃ¡ctil, offline-capable
4. **Progressive Enhancement**: Funcional sin JS, mejor con JS
5. **Accessibility**: WCAG 2.1 AA mÃ­nimo
6. **Performance**: Core Web Vitals Ã³ptimos

## ğŸ‰ RESUMEN DE LO LOGRADO EN 2 HORAS (4 Oct 2025)

### âœ… Completamente Implementado:
1. **AutenticaciÃ³n completa** - Login, registro, recuperaciÃ³n de contraseÃ±a, logout
2. **Dashboard funcional** - EstadÃ­sticas, actividad reciente, acciones rÃ¡pidas
3. **GestiÃ³n de Consultantes CRUD** - Crear, listar, ver detalle, editar, eliminar
4. **GestiÃ³n de Sesiones CRUD** - Crear, listar, ver detalle, editar, eliminar
5. **Sistema de Cifrado E2E** - AES-256-GCM para datos sensibles
6. **BÃºsqueda y Filtros** - BÃºsqueda en tiempo real, filtros por estado
7. **ConfiguraciÃ³n de Perfil** - Editar informaciÃ³n personal, cambiar contraseÃ±a
8. **Agenda BÃ¡sica** - Vista de citas programadas
9. **11 PÃ¡ginas completas** - Todas responsive y con validaciÃ³n
10. **8 Componentes UI** - Button, Input, Textarea, Label, Card, etc.
11. **Sistema de Rutas** - Estructura completa y consistente
12. **RLS en Supabase** - Seguridad a nivel de base de datos

### ğŸ“Š MÃ©tricas:
- **Tiempo total:** 2 horas
- **PÃ¡ginas implementadas:** 11
- **LÃ­neas de cÃ³digo:** ~3,500
- **Componentes UI:** 8
- **Server Actions:** 12+
- **Tablas de BD:** 5 (con RLS)

### ğŸš€ PrÃ³ximas Prioridades (Esta Semana):
1. **Asistente de IA** - Reactivar y configurar correctamente
2. **Sistema de Citas mejorado** - Calendario, crear/editar citas
3. **Dashboard con grÃ¡ficos** - VisualizaciÃ³n de estadÃ­sticas
4. **BÃºsqueda global** - BÃºsqueda unificada en toda la app

---

## PrÃ³ximos Pasos

### Fase 0: Setup Inicial âœ… COMPLETADO
- [x] Configurar Supabase proyecto
- [x] Crear tablas iniciales con migrations
- [x] Configurar variables de entorno
- [x] Setup ESLint rules especÃ­ficas para el proyecto
- [x] Configurar TypeScript strict mode

### Fase 1: AutenticaciÃ³n y Base âœ… COMPLETADO (2 horas)
- [x] Configurar Supabase Auth con TypeScript
  - [x] Email/Password provider
  - [ ] Magic Link opcional (futuro)
  - [x] Password recovery
  - [x] Email verification
- [x] Crear sistema de cifrado para datos sensibles
  - [x] Utilidad de encriptaciÃ³n/desencriptaciÃ³n (AES-256-GCM)
  - [x] Key management seguro
  - [x] Cifrado de campos en server-side
- [x] Implementar Server Actions
  - [x] Actions para consultantes (create, update, delete, get)
  - [x] Actions para sesiones (create, update, delete, get)
  - [x] Actions para perfil (update, getProfile)
  - [x] ValidaciÃ³n con Zod
  - [x] Error handling completo
- [x] Dashboard layout bÃ¡sico
  - [x] Header con navbar
  - [x] User menu con nombre y configuraciÃ³n
  - [x] Mobile responsive
  - [x] Logout functionality
- [x] Schema inicial + RLS policies completas

### Fase 2: GestiÃ³n de Consultantes âœ… COMPLETADO (2 horas)
- [x] CRUD consultantes completo
  - [x] Formulario de creaciÃ³n con validaciÃ³n
  - [x] Vista de lista con bÃºsqueda/filtros
  - [x] Vista de detalle individual
  - [x] EdiciÃ³n completa
  - [x] EliminaciÃ³n (hard delete por ahora)
- [x] DiseÃ±ar componentes de UI especÃ­ficos
  - [x] Card de consultante con gradientes
  - [x] PÃ¡gina de ediciÃ³n dedicada
  - [x] Grid responsive con cards
  - [x] Empty states con ilustraciÃ³n
- [x] Timeline de sesiones por consultante (Ãºltimas 5)
- [ ] Sistema de documentos adjuntos (Supabase Storage) - PENDIENTE
- [ ] GrÃ¡ficos bÃ¡sicos de evoluciÃ³n - PENDIENTE

### Fase 3: Sistema de Sesiones + IA âš ï¸ PARCIALMENTE COMPLETADO (2 horas)
- [x] CRUD de sesiones
  - [x] Formulario de registro de sesiÃ³n completo
  - [x] Vista de historial con cards
  - [x] Vista de detalle individual
  - [x] EdiciÃ³n de notas y toda la informaciÃ³n
- [x] Configurar OpenRouter bÃ¡sico
  - [x] Cliente TypeScript configurado
  - [ ] Streaming de respuestas - PENDIENTE
  - [ ] Rate limiting - PENDIENTE
  - [x] Error handling bÃ¡sico
- [ ] Asistente IA para notas - DESHABILITADO temporalmente
  - [ ] GeneraciÃ³n de resumen de sesiÃ³n - PENDIENTE
  - [ ] Sugerencias de objetivos terapÃ©uticos - PENDIENTE
  - [ ] AnÃ¡lisis de patrones - PENDIENTE
  - [ ] Chat interface con streaming - PENDIENTE
- [ ] Plantillas de notas clÃ­nicas - PENDIENTE
- [ ] Timer de sesiÃ³n con notificaciones - PENDIENTE
- [ ] Exportar sesiones a PDF - PENDIENTE

### Fase 4: Agenda y Recordatorios âš ï¸ INICIADO (2 horas)
- [x] Sistema de agenda bÃ¡sico
  - [x] Vista lista de citas ordenadas por fecha
  - [ ] Vista calendario (dÃ­a/semana/mes) - PENDIENTE
  - [ ] Crear/editar/eliminar citas - PENDIENTE
  - [ ] Drag & drop para reprogramar - PENDIENTE
  - [ ] Bloques de disponibilidad - PENDIENTE
- [ ] Recordatorios automÃ¡ticos - PENDIENTE
  - [ ] Email notifications (Supabase + Resend/SendGrid)
  - [ ] ConfiguraciÃ³n de preferencias
  - [ ] Cron jobs con Edge Functions
- [ ] ConfirmaciÃ³n de citas por consultante - PENDIENTE
- [ ] SincronizaciÃ³n con Google Calendar (opcional) - PENDIENTE
- [ ] Lista de espera para citas - PENDIENTE

### Fase 5: PWA y Offline (Semanas 9-10)
- [ ] Configurar PWA bÃ¡sico
  - [ ] Service Worker
  - [ ] Manifest.json
  - [ ] Icons y splash screens
- [ ] Cache estratÃ©gico
  - [ ] Cache de assets estÃ¡ticos
  - [ ] Cache de datos crÃ­ticos
  - [ ] Offline fallbacks
- [ ] Sync en background
- [ ] InstalaciÃ³n en dispositivos mÃ³viles
- [ ] Push notifications (futuro)

### Fase 6: Telegram Bot (Semanas 11-12)
- [ ] Setup Telegram bot
  - [ ] Bot Token y webhooks
  - [ ] IntegraciÃ³n con Telegraf
- [ ] Comandos bÃ¡sicos
  - [ ] /start - VinculaciÃ³n de cuenta
  - [ ] /agenda - Ver agenda del dÃ­a
  - [ ] /nota - Agregar nota rÃ¡pida
  - [ ] /recordatorios - Gestionar recordatorios
- [ ] IntegraciÃ³n con OpenRouter
  - [ ] /consulta - Consultar IA sobre casos
  - [ ] Conversaciones contextuales
- [ ] Notificaciones push vÃ­a Telegram
- [ ] AutenticaciÃ³n segura bot â†” app

### Fase 7: Herramientas ClÃ­nicas Avanzadas (Semanas 13-14)
- [ ] Tests psicomÃ©tricos digitales
  - [ ] Biblioteca de tests (PHQ-9, GAD-7, etc)
  - [ ] AplicaciÃ³n digital de tests
  - [ ] Scoring automÃ¡tico
  - [ ] Historial de resultados
- [ ] Generador de objetivos SMART con IA
- [ ] Biblioteca de recursos terapÃ©uticos
  - [ ] TÃ©cnicas por enfoque teÃ³rico
  - [ ] Ejercicios para consultantes
  - [ ] Lecturas recomendadas
- [ ] Plantillas de planes de tratamiento
- [ ] Sistema de derivaciones

### Fase 8: AnÃ¡lisis y Reportes (Semanas 15-16)
- [ ] Dashboard de estadÃ­sticas
  - [ ] Horas trabajadas
  - [ ] Tipos de consulta
  - [ ] Tasa de retenciÃ³n
  - [ ] EvoluciÃ³n de consultantes
- [ ] GrÃ¡ficos de evoluciÃ³n avanzados
  - [ ] MÃ©tricas clÃ­nicas personalizables
  - [ ] ComparaciÃ³n temporal
  - [ ] ExportaciÃ³n de grÃ¡ficos
- [ ] Sistema de facturaciÃ³n integrado
  - [ ] GeneraciÃ³n de recibos
  - [ ] Registro de pagos
  - [ ] Reportes contables
- [ ] ExportaciÃ³n de datos (CSV, PDF)
- [ ] AnÃ¡lisis con IA
  - [ ] PredicciÃ³n de riesgo de abandono
  - [ ] DetecciÃ³n de patrones
  - [ ] Sugerencias de intervenciones

### Fase 9: Comunidad y Desarrollo Profesional (Semanas 17-18)
- [ ] Feed de investigaciÃ³n personalizado
  - [ ] Agregador de papers
  - [ ] ResÃºmenes con IA
  - [ ] Filtros por Ã¡reas de interÃ©s
- [ ] Casos clÃ­nicos anÃ³nimos
  - [ ] Foro de consulta entre colegas
  - [ ] Sistema de anonimizaciÃ³n
  - [ ] ModeraciÃ³n de contenido
- [ ] Registro de supervisiones
- [ ] Certificados de formaciÃ³n continua
- [ ] Red de profesionales (networking)

### Fase 10: Testing y OptimizaciÃ³n (Semanas 19-20)
- [ ] Testing completo
  - [ ] Unit tests (componentes crÃ­ticos)
  - [ ] Integration tests (Server Actions)
  - [ ] E2E tests (flujos crÃ­ticos con Playwright)
- [ ] OptimizaciÃ³n de performance
  - [ ] Lazy loading de componentes
  - [ ] Image optimization
  - [ ] Bundle size analysis
  - [ ] Core Web Vitals
- [ ] AuditorÃ­a de seguridad
  - [ ] Penetration testing
  - [ ] OWASP Top 10
  - [ ] Review de RLS policies
- [ ] AuditorÃ­a de accesibilidad (WCAG 2.1 AA)
- [ ] Beta testing con 5-10 profesionales
- [ ] IteraciÃ³n segÃºn feedback

### Backlog / Futuro
- [ ] App mÃ³vil nativa (React Native/Flutter)
- [ ] IntegraciÃ³n con videollamadas (Zoom/Meet)
- [ ] Whiteboard colaborativo para sesiones
- [ ] TranscripciÃ³n automÃ¡tica de sesiones (Whisper)
- [ ] Multi-idioma (i18n)
- [ ] Modo oscuro
- [ ] PersonalizaciÃ³n de temas
- [ ] Sistema de roles (admin, supervisor, terapeuta)
- [ ] Multi-tenancy para clÃ­nicas
- [ ] Integraciones con EHR/EMR externos
- [ ] API pÃºblica para terceros
- [ ] Marketplace de recursos terapÃ©uticos

## Consideraciones Ã‰ticas y Legales

- âœ… Consentimiento informado para uso de IA
- âœ… Transparencia sobre almacenamiento de datos
- âœ… Derecho al olvido (eliminaciÃ³n completa)
- âœ… Portabilidad de datos
- âœ… AuditorÃ­a de accesos
- âœ… Cumplimiento normativas locales de salud

---

**Â¿Necesitas ayuda con alguna parte especÃ­fica?** Puedo generar:
- Componentes de UI especÃ­ficos
- Server Actions para Supabase
- IntegraciÃ³n con OpenRouter
- Schema migrations
- ConfiguraciÃ³n de autenticaciÃ³n
- LÃ³gica de cifrado
- Y mucho mÃ¡s...